<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rep Team Performance Dashboard</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg0:#05070d;
  --bg1:#0b1220;
  --card:rgba(16,25,46,.92);
  --border:rgba(255,255,255,.10);
  --text:#f1f5ff;
  --muted:#a6b4d6;
  --accent:#4cc9f0;
  --green:#2dff88;
  --amber:#ffd166;
  --red:#ff4d6d;
  --radius:18px;
  --shadow:0 30px 80px rgba(0,0,0,.65);
  --font:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:var(--font);
  background:
    radial-gradient(1200px 600px at 10% -10%,#12204a33,transparent),
    linear-gradient(180deg,var(--bg1),var(--bg0));
  color:var(--text);
}

/* ===== HEADER ===== */
header{
  padding:20px 22px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

h1{
  font-size:20px;
  margin:0;
}

.controls{
  display:flex;
  gap:10px;
}

button, select{
  background:rgba(255,255,255,.06);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:999px;
  padding:8px 14px;
  font-weight:600;
  cursor:pointer;
}

button.active{
  background:linear-gradient(135deg,#4cc9f0,#4895ef);
  color:#04131f;
  border:none;
}

/* ===== GRID ===== */
.dashboard{
  padding:18px;
  display:grid;
  gap:18px;
}

/* ===== SUMMARY ===== */
.summary{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:14px;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:14px;
  box-shadow:var(--shadow);
}

.card h3{
  margin:0;
  font-size:12px;
  color:var(--muted);
}

.card .value{
  margin-top:6px;
  font-size:26px;
  font-weight:800;
}

/* ===== PLAYERS ===== */
.players{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:14px;
}

.player{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:14px;
}

.player .name{
  font-weight:800;
}

.player .meta{
  font-size:12px;
  color:var(--muted);
  margin-bottom:6px;
}

.stat{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  margin-top:6px;
}

/* ===== IMPACT ===== */
.impact-row{
  display:flex;
  gap:8px;
  align-items:center;
  margin:8px 0;
  font-size:12px;
}

.impact-badge{
  padding:3px 8px;
  border-radius:999px;
  font-weight:700;
}

.green{ background:rgba(45,255,136,.18); color:var(--green); }
.amber{ background:rgba(255,209,102,.18); color:var(--amber); }
.red{ background:rgba(255,77,109,.18); color:var(--red); }

/* ===== CHART ===== */
.chart-card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:14px;
}
</style>
</head>

<body>

<header>
  <h1>üèÄ Rep Team Performance</h1>
  <div class="controls">
    <button id="gameBtn" class="active">Game</button>
    <button id="seasonBtn">Season</button>
    <select id="gameSelect"></select>
  </div>
</header>

<section class="dashboard">

  <!-- SUMMARY -->
  <div class="summary">
    <div class="card">
      <h3>Games</h3>
      <div class="value" id="gamesPlayed">0</div>
    </div>
    <div class="card">
      <h3>Points</h3>
      <div class="value" id="avgPoints">0</div>
    </div>
    <div class="card">
      <h3>Against</h3>
      <div class="value" id="avgAgainst">0</div>
    </div>
    <div class="card">
      <h3>Net</h3>
      <div class="value" id="netRating">0</div>
    </div>
  </div>

  <!-- CHART -->
  <div class="chart-card">
    <canvas id="scoreChart" height="120"></canvas>
  </div>

  <!-- PLAYERS -->
  <div class="players" id="players"></div>

</section>

<script>
let seasonData, scoreChart;
let viewMode = "game";

/* ===== SAFE STAT ===== */
function stat(v){
  return Number.isFinite(v) ? v : 0;
}

/* ===== IMPACT ===== */
function impact(p){
  return (
    stat(p.points) +
    stat(p.rebounds) +
    (stat(p.steals) * 1.5) +
    stat(p.assists) -
    (stat(p.fouls) * 0.5)
  );
}
function impactTier(v){
  if (v >= 7) return ["High Impact", "green"];
  if (v >= 3) return ["Solid", "amber"];
  if (v >= 1) return ["Opportunity to Grow", "blue"];
  return ["Limited Impact", "red"];
}
/* ===== FETCH ===== */
fetch("data/season-2026.json?t=" + Date.now())
  .then(r => r.json())
  .then(d => { seasonData = d; init(); });

/* ===== INIT ===== */
function init(){
  const sel = document.getElementById("gameSelect");
  sel.innerHTML = "";

  seasonData.games.forEach((g,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.text=`Round ${g.round} vs ${g.opponent}`;
    sel.appendChild(o);
  });

  sel.onchange=()=>render();
  document.getElementById("gameBtn").onclick=()=>switchView("game");
  document.getElementById("seasonBtn").onclick=()=>switchView("season");

  render();
}

/* ===== VIEW SWITCH ===== */
function switchView(mode){
  viewMode = mode;
  document.getElementById("gameBtn").classList.toggle("active", mode==="game");
  document.getElementById("seasonBtn").classList.toggle("active", mode==="season");
  render();
}

/* ===== RENDER ===== */
function render(){
  if(viewMode==="game"){
    renderGame(seasonData.games[gameSelect.value || 0]);
  } else {
    renderSeason();
  }
}
/* ===== GAME VIEW ===== */
function renderGame(g){
  document.getElementById("gamesPlayed").textContent = seasonData.games.length;
  document.getElementById("avgPoints").textContent = g.teamScore;
  document.getElementById("avgAgainst").textContent = g.oppScore;
  document.getElementById("netRating").textContent = g.teamScore - g.oppScore;

  renderPlayers(g.players);
  renderChart(g.teamScore, g.oppScore);
}

/* ===== SEASON VIEW ===== */
function renderSeason(){
  const games = seasonData.games.length;
  const forPts = seasonData.games.reduce((a,g)=>a+g.teamScore,0);
  const agPts  = seasonData.games.reduce((a,g)=>a+g.oppScore,0);

  document.getElementById("gamesPlayed").textContent = games;
  document.getElementById("avgPoints").textContent = Math.round(forPts/games);
  document.getElementById("avgAgainst").textContent = Math.round(agPts/games);
  document.getElementById("netRating").textContent = Math.round((forPts-agPts)/games);

  renderPlayers(
    Object.values(
      seasonData.games.flatMap(g=>g.players)
        .reduce((m,p)=>{
          const k=p.number;
          if(!m[k]) m[k]={...p};
          else{
            ["points","rebounds","steals","assists","fouls"].forEach(s=>{
              m[k][s]=stat(m[k][s])+stat(p[s]);
            });
          }
          return m;
        },{})
    )
  );

  renderChart(forPts/games, agPts/games);
}

/* ===== PLAYERS ===== */
function renderPlayers(players){
  const wrap=document.getElementById("players");
  wrap.innerHTML="";

  players
    .filter(p=>p.name && p.number!==null)
    .forEach(p=>{
      const i=impact(p);
      const [label,color]=impactTier(i);

      wrap.innerHTML+=`
        <div class="player">
          <div class="name">#${p.number} ${p.name}</div>
          <div class="meta">${viewMode==="game"?"Game Stats":"Season Stats"}</div>

          <div class="impact-row">
            <strong>${i.toFixed(1)}</strong>
            <span class="impact-badge ${color}">${label}</span>
          </div>

          <div class="stat"><span>Points</span><strong>${stat(p.points)}</strong></div>
          <div class="stat"><span>Rebounds</span><strong>${stat(p.rebounds)}</strong></div>
          <div class="stat"><span>Steals</span><strong>${stat(p.steals)}</strong></div>
          <div class="stat"><span>Assists</span><strong>${stat(p.assists)}</strong></div>
          <div class="stat"><span>Fouls</span><strong>${stat(p.fouls)}</strong></div>
        </div>`;
    });
}

/* ===== CHART ===== */
function renderChart(forVal, agVal){
  const ctx=document.getElementById("scoreChart").getContext("2d");
  if(scoreChart) scoreChart.destroy();

  scoreChart=new Chart(ctx,{
    type:"bar",
    data:{
      labels:["For","Against"],
      datasets:[{
        data:[forVal,agVal],
        backgroundColor:["#2dff88","#ff4d6d"]
      }]
    },
    options:{
      plugins:{legend:{display:false}},
      scales:{y:{beginAtZero:true}}
    }
  });
}
</script>

</body>
</html>
